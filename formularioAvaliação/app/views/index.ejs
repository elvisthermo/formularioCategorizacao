<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Formulário de Avaliação</title>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="data/ML.js"></script>
    <script src="data/FACEBOOK.js"></script>
    <script src="data/GOOGLE.js"></script>
    <script src="data/G1.js"></script>
    <script src="data/UFPA.js"></script>
    <script src="data/YOUTUBE.js"></script>
    <link href="css/style.css" rel="stylesheet">

</head>
<body class="body-index">
<div class="custom-background"></div>
<nav class="navbar navbar-default navbar-static-top">

    <div class="container">
        <% if(validacao.length > 0){ %>
            <div class="alert alert-danger">
                <strong>Atenção!</strong>
                <ul>
                    <% for(var i = 0; i < validacao.length; i++){ %>
                        <li><%= validacao[i].msg %></li>
                    <% } %>
                </ul>
            </div>
        <% } %>
        <% if (typeof finalizado !== "undefined"){ %>
        <% console.log("formularsio finalizado"); }%>
        <% var route = "cadastrar" %>
        <%  if(number>0){%>
            <%      route = "cadastrarQuests";%>
        <%  }%>
        <% typeof _id == "undefined"?  console.log("not access "): console.log(" access "+_id) %>

        <form id="regForm" action="<%=route%>" method="POST">
            <h1>Formulario de Avaliação:</h1>

            <div class="tab">
                <p><input placeholder="Digite seu email"  type="email" name="_id"  value=" <%= typeof _id == "undefined"? "": _id %>"></p>
                <p><input placeholder=" Digite seu nome"  type="text" name="name" required></p>
            </div>


            <script>
                let cont = 0;

                $(ml).each(function (item,element) {
                    console.log(item);
                    console.log("teste de elemento:",element);
                    if(element!==""){

                        $('#regForm').append($("<div>")
                            .addClass("tab")
                            .append($("<div/>")
                                .addClass("type")
                                .attr("value","Mercado livre: "+element+"")
                                .append($("<h3/>").text("Mercado livre: "+element+""))
                                .append($("<p/>").text("Interação")
                                    .append($("<input/>")
                                        .addClass("Interacao")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interação")
                                    ))
                                .append($("<p/>").text("Interface")
                                    .append($("<input/>")
                                        .addClass("Interface")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interface")
                                    ))
                                .append($("<p/>").text("Experiência")
                                    .append($("<input/>")
                                        .addClass("Experiencia")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Experiência")
                                    ))
                            ));
                    // cont+=1;
                    }
                });

                $(facebook).each(function (item,element) {
                    if(element!==""){

                        $('#regForm').append($("<div>")
                            .addClass("tab")
                            .append($("<div/>")
                                .addClass("type")
                                .attr("value","Facebook: "+element+"")
                                .append($("<h3/>").text("Facebook: "+element+""))
                                .append($("<p/>").text("Interação")
                                    .append($("<input/>")
                                        .addClass("Interacao")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interação")
                                    ))
                                .append($("<p/>").text("Interface")
                                    .append($("<input/>")
                                        .addClass("Interface")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interface")
                                    ))
                                .append($("<p/>").text("Experiência")
                                    .append($("<input/>")
                                        .addClass("Experiencia")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Experiência")
                                    ))
                            ));
                    // cont+=1;
                    }
                });

                $(g1).each(function (item,element) {
                    if(element!==""){

                        $('#regForm').append($("<div>")
                            .addClass("tab")
                            .append($("<div/>")
                                .addClass("type")
                                .attr("value","G1: "+element+"")
                                .append($("<h3/>").text("G1: "+element+""))
                                .append($("<p/>").text("Interação")
                                    .append($("<input/>")
                                        .addClass("Interacao")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interação")
                                    ))
                                .append($("<p/>").text("Interface")
                                    .append($("<input/>")
                                        .addClass("Interface")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interface")
                                    ))
                                .append($("<p/>").text("Experiência")
                                    .append($("<input/>")
                                        .addClass("Experiencia")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Experiência")
                                    ))
                            ));
                    // cont+=1;
                    }
                });

                $(goolge).each(function (item,element) {
                    if(element!==""){

                        $('#regForm').append($("<div>")
                            .addClass("tab")
                            .append($("<div/>")
                                .addClass("type")
                                .attr("value","Google: "+element+"")
                                .append($("<h3/>").text("Google: "+element+""))
                                .append($("<p/>").text("Interação")
                                    .append($("<input/>")
                                        .addClass("Interacao")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interação")
                                    ))
                                .append($("<p/>").text("Interface")
                                    .append($("<input/>")
                                        .addClass("Interface")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interface")
                                    ))
                                .append($("<p/>").text("Experiência")
                                    .append($("<input/>")
                                        .addClass("Experiencia")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Experiência")
                                    ))
                            ));
                    // cont+=1;
                    }
                });

                $(ufpa).each(function (item,element) {
                    if(element!==""){

                        $('#regForm').append($("<div>")
                            .addClass("tab")
                            .append($("<div/>")
                                .addClass("type")
                                .attr("value","Ufpa: "+element+"")
                                .append($("<h3/>").text("Ufpa: "+element+""))
                                .append($("<p/>").text("Interação")
                                    .append($("<input/>")
                                        .addClass("Interacao")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interação")
                                    ))
                                .append($("<p/>").text("Interface")
                                    .append($("<input/>")
                                        .addClass("Interface")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interface")
                                    ))
                                .append($("<p/>").text("Experiência")
                                    .append($("<input/>")
                                        .addClass("Experiencia")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Experiência")
                                    ))
                            ));
                    }
                    // cont+=1;
                });

                $(youtube).each(function (item,element) {
                    console.log(item);
                    console.log("teste de elemento:",element);
                    if(element!==""){

                        $('#regForm').append($("<div>")
                            .addClass("tab")
                            .append($("<div/>")
                                .addClass("type")
                                .attr("value","Youtube: "+element+"")
                                .append($("<h3/>").text("Youtube: "+element+""+cont))
                                .append($("<p/>").text("Interação")
                                    .append($("<input/>")
                                        .addClass("Interacao")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interação")
                                    ))
                                .append($("<p/>").text("Interface")
                                    .append($("<input/>")
                                        .addClass("Interface")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Interface")
                                    ))
                                .append($("<p/>").text("Experiência")
                                    .append($("<input/>")
                                        .addClass("Experiencia")
                                        .attr("type","radio")
                                        .attr("name","tipo"+cont)
                                        .attr("id",cont)
                                        .attr("value","Experiência")
                                    ))
                            ));
                    // cont+=1;
                    }
                });

                console.log("final contdow:"+cont);

                //-----------------seleção da interação---------------------------------------------
                $(".Interacao").click(function () {
                    //remover
                    $(".sub-menus").remove();

                    let name = $(this).attr("id");
                    let text = $(this).parent().parent().children("h3").text();

                    $(this).parent().parent()
                        .append($("<div>")
                            .addClass("sub-menus")
                            .append($("<input/>").attr("name","frase"+name)
                                .attr("value",text)
                                .css("display","nome").hide())
                            .append($("<h4/>").text("Diga mais sobre como classificaria esse erro Interação:"))
                            .append($("<p/>").text("Precisão")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Precisão").text("Precisão")))
                            .append($("<p/>").text("tempo de click")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","tempo de click").text("tempo de click")))
                            .append($("<p/>").text("velocidade de movimentação")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","velocidade de movimentação").text("velocidade de movimentação")))
                            .append($("<p/>").text("outros")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("value","outros")
                                    .attr("name","subtipo"+name))
                                .append($("<input/>")
                                    .attr("type","textarea")
                                    .attr("name","subtipo"+name)
                                    .attr("placeholder","Digite a resposta"))
                            ));
                });

                //--------------------submenu interface----------------------------------------
                $(".Interface").click(function () {
                    //remover
                    $(".sub-menus").remove()
                    let name = $(this).attr("id");
                    let text = $(this).parent().parent().children("h3").text();

                    console.log(name);
                    $(this).parent().parent()
                        .append($("<div/>").addClass("sub-menus")
                            .append($("<input/>").attr("name","frase"+name)
                                .attr("value",text)
                                .css("display","nome").hide())
                            .append($("<h4/>").text("Diga mais sobre como classificaria esse erro de Interface:"))
                            .append($("<p/>").text("Tamanho do componente")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Tamanho do componente")))
                            .append($("<p/>").text("Tipo do componente")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Tipo do componente")))
                            .append($("<p/>").text("Localização do componente")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Localização do componente")))
                            .append($("<p/>").text("outros")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("value","outros")
                                    .attr("name","subtipo"+name))
                                .append($("<input/>")
                                    .attr("type","textarea")
                                    .attr("name","subtipo"+name)
                                    .attr("placeholder","Digite a resposta"))
                            ));
                });

                //-----------------------------------------------expreriencia----------------------------------------------
                $(".Experiencia").click(function () {
                    //remover
                    $(".sub-menus").remove();

                    let text = $(this).parent().parent().children("h3").text();
                    let name = $(this).attr("id");

                    $(this).parent().parent()
                        .append($("<div/>").addClass("sub-menus")

                            .append($("<input/>").attr("name","frase"+name)
                                .attr("value",text)
                                .css("display","nome").hide())
                            .append($("<h4/>").text("Diga mais sobre como classificaria esse erro de Experiencia:"))
                            .append($("<p/>").text("Frustração")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Frustração")))
                            .append($("<p/>").text("Esforço Fisico")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Esforço Fisico")))
                            .append($("<p/>").text("Estratégias para evitar erros")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Estratégias para evitar erros")))
                            .append($("<p/>").text("Confusão")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Confusão")))
                            .append($("<p/>").text("Conforto")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("name","subtipo"+name)
                                    .attr("value","Conforto")))
                            .append($("<p/>").text("outros")
                                .append($("<input/>")
                                    .attr("type","radio")
                                    .attr("value","outros")
                                    .attr("name","subtipo"+name))
                                .append($("<input/>")
                                    .attr("type","textarea")
                                    .attr("name","subtipo"+name)
                                    .attr("placeholder","Digite a resposta"))
                            ));
                });

            </script>

            <div class="tab">
                <label><input id="number" type="number" name="number" value="<%=number %>" ></label><br>

            </div>

            <div style="overflow:auto;">
                <div style="float:right;">
                    <button type="button" id="prevBtn" onclick="backPrev(-1)">Previous</button>
                    <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
                </div>
            </div>
            <!--citculos dos passos do formulario-->

            <div>
                <%if(number!==0){ %>
                <%=Math.floor((number*100/739).toFixed(2))+"% concluido"%>
                <%}%>

            </div>
            <div class="qtd" style="text-align:center;margin-top:40px;">
            </div>
            <script>
                $( document ).ready(function() {
                    $(ml).each(function () {
                        $(".qtd").append($("<span/>").addClass("step"))
                    });

                    $(".qtd").hide();

                });


            </script>

        </form>
        <script>
            let element = document.getElementById("number").value;
            console.log(element);

            let currentTab = element;

            showTab(currentTab);
            function showTab(n) {
                // This function will display the specified tab of the form...
                let x = document.getElementsByClassName("tab");
                x[n].style.display = "block";
                //... and fix the Previous/Next buttons:
                if (n == 0) {
                    document.getElementById("prevBtn").style.display = "none";
                } else {
                    document.getElementById("prevBtn").style.display = "inline";
                }
                if (n == (x.length - 2)) {
                    document.getElementById("nextBtn").innerHTML = "Finalizar";
                } else {
                    document.getElementById("nextBtn").innerHTML = "next";
                }
                //... and run a function that will display the correct step indicator:
                fixStepIndicator(n)
            }

            function backPrev(n) {

                let x = document.getElementsByClassName("tab");
                if (n == 1 && !validateForm()) return false;
                x[currentTab].style.display = "none";
                currentTab = currentTab -1;
                if(element>currentTab){
                    console.log(currentTab);
                    document.getElementById("number").value = currentTab;
                }

                if (currentTab >= x.length) {
                    document.getElementById("regForm").submit();
                    return false;
                }
                showTab(currentTab);
            }

            function nextPrev(n) {
                // Esta função irá descobrir qual guia exibir
                let x = document.getElementsByClassName("tab");

                if (n == 1 && !validateForm()) return false;
                // Saia da função se algum campo da aba atual for inválido:
                document.getElementById("regForm").submit();
                x[currentTab].style.display = "none";
                // Aumenta ou diminui a aba atual em 1:
                //currentTab = currentTab + n;
                // se você chegou ao final do formulário ...
                if(currentTab >= x.length){
                    // ... o formulário é enviado:
                    //document.getElementById("regForm").submit();
                    return false;
                }
                showTab(currentTab);
            }

            function validateForm() {
                // Esta função lida com a validação dos campos do formulário
                let x, y, i, valid = true, count=0;
                x = document.getElementsByClassName("tab");
                y = x[currentTab].getElementsByTagName("input");

                let choices = [];
                var els = x[currentTab].getElementsByClassName("radio");
                //alert(els.length.toString());
                for (let i=0;i<els.length;i++){
                    if ( els[i].checked == false ) {
                        count++;
                        if(count == els.length){
                            els[0].className += " invalid";
                            els[1].className += " invalid";
                            els[2].className += " invalid";

                            valid = false;
                        }else if(count<3){
                            valid = true;

                        }

                    }
                    //    choices.push(els[i].value);
                    //  }
                }

                // Um ​​loop que verifica todos os campos de entrada na guia atual:
                for (i = 0; i < y.length; i++) {
                    // campo vazio
                    if (y[i].value == "") {
                        // add class invalid:
                        // y[i].className += " invalid";
                        // valid = false;
                    }
                }
                // Se o status válido for verdadeiro, marque a etapa como concluída e válida:
                if (valid) {
                    document.getElementsByClassName("step")[currentTab].className += " finish";
                }
                return valid;// devolve o status válido
            }

            function fixStepIndicator(n) {
                let i, x = document.getElementsByClassName("step");
                for (i = 0; i < x.length; i++) {
                    x[i].className = x[i].className.replace(" active", "");
                }
                x[n].className += " active";
            }
        </script>

</body>
</html>